(function(C,q){typeof exports=="object"&&typeof module!="undefined"?q(exports):typeof define=="function"&&define.amd?define(["exports"],q):q((C=typeof globalThis!="undefined"?globalThis:C||self).TileMapHelper={})})(this,function(C){"use strict";var q=function(e,t){return q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i[n]=r[n])},q(e,t)};function xt(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}q(e,t),e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}function W(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Y(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var r,n,l=i.call(e),o=[];try{for(;(t===void 0||t-- >0)&&!(r=l.next()).done;)o.push(r.value)}catch(s){n={error:s}}finally{try{r&&!r.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}return o}function N(e,t,i){if(i||arguments.length===2)for(var r,n=0,l=t.length;n<l;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}var B,Z=2147483648,tt=1073741824,et=536870912;function st(e){var t=B.isFlippedDiagonally(e),i=B.isFlippedHorizontally(e),r=B.isFlippedVertically(e),n=0;return t?(n=10,!i&&r?n=2:i&&!r?n=6:i&&r&&(n=14)):(n=0,!i&&r?n=8:i&&!r?n=12:i&&r&&(n=4)),n}function It(e,t,i,r){var n=e;return t&&(n|=Z),i&&(n|=tt),r&&(n|=et),n}(function(e){e.tileIdMask=536870911,e.getTileId=function(t){return t&e.tileIdMask},e.setFlippedHorizontally=function(t,i){return t&=2147483647,i&&(t|=Z),t},e.setFlippedVertically=function(t,i){return t&=-1073741825,i&&(t|=tt),t},e.setFlippedDiagonally=function(t,i){return t&=-536870913,i&&(t|=et),t},e.isFlippedHorizontally=function(t){return(t&Z)!=0},e.isFlippedVertically=function(t){return(t&tt)!=0},e.isFlippedDiagonally=function(t){return(t&et)!=0}})(B||(B={}));var ct=function(){function e(t,i,r,n,l){this.tileWidth=t,this.tileHeight=i,this.dimX=r,this.dimY=n,this._tileSet=l,this._layers=[]}return e.prototype.getWidth=function(){return this.tileWidth*this.dimX},e.prototype.getHeight=function(){return this.tileHeight*this.dimY},e.prototype.getTileHeight=function(){return this.tileHeight},e.prototype.getTileWidth=function(){return this.tileWidth},e.prototype.getDimensionX=function(){return this.dimX},e.prototype.getDimensionY=function(){return this.dimY},e.prototype.getTileDefinition=function(t){return this._tileSet.get(t)},e.prototype.getTileDefinitions=function(){return this._tileSet.values()},e.prototype.addTileLayer=function(t){var i=new it(this,t);return this._layers.push(i),i},e.prototype.addObjectLayer=function(t){var i=new wt(this,t);return this._layers.push(i),i},e.prototype.getBackgroundResourceName=function(){return this._backgroundResourceName},e.prototype.getLayers=function(){return this._layers},e.prototype.pointIsInsideTile=function(t,i,r){var n,l,o=Math.floor(t/this.tileWidth),s=Math.floor(i/this.tileHeight);try{for(var p=W(this._layers),a=p.next();!a.done;a=p.next()){var d=a.value;if(d){var c=d.getTileId(o,s);if(c===void 0)return!1;if(this._tileSet.get(c).hasTaggedHitBox(r))return!0}}}catch(u){n={error:u}}finally{try{a&&!a.done&&(l=p.return)&&l.call(p)}finally{if(n)throw n.error}}return!1},e.prototype.setBackgroundResourceName=function(t){this._backgroundResourceName=t},e}(),_t=function(){function e(t,i){this.visible=!0,this.tileMap=t,this.id=i}return e.prototype.setVisible=function(t){this.visible=t},e.prototype.isVisible=function(){return this.visible},e}(),wt=function(e){function t(i,r){var n=e.call(this,i,r)||this;return n.objects=[],n}return xt(t,e),t.prototype.add=function(i){this.objects.push(i)},t}(_t),Ht=function(){function e(t,i,r){this.tileId=r,this.x=t,this.y=i}return e.prototype.getTileId=function(){return B.getTileId(this.tileId)},e.prototype.setFlippedHorizontally=function(t){this.tileId=B.setFlippedHorizontally(this.tileId,t)},e.prototype.setFlippedVertically=function(t){this.tileId=B.setFlippedVertically(this.tileId,t)},e.prototype.setFlippedDiagonally=function(t){this.tileId=B.setFlippedDiagonally(this.tileId,t)},e.prototype.isFlippedHorizontally=function(){return B.isFlippedHorizontally(this.tileId)},e.prototype.isFlippedVertically=function(){return B.isFlippedVertically(this.tileId)},e.prototype.isFlippedDiagonally=function(){return B.isFlippedDiagonally(this.tileId)},e}(),it=function(e){function t(i,r){var n=e.call(this,i,r)||this;n._tiles=[],n._tiles.length=n.tileMap.getDimensionY();for(var l=0;l<n._tiles.length;l++)n._tiles[l]=new Int32Array(n.tileMap.getDimensionX());return n._alpha=1,n}return xt(t,e),t.prototype.getAlpha=function(){return this._alpha},t.prototype.setAlpha=function(i){this._alpha=i},t.prototype.setTile=function(i,r,n){if(this.tileMap.getTileDefinition(n)){var l=this._tiles[r];!l||i>=l.length||(l[i]=n+1)}else console.error("Invalid tile definition index: ".concat(n))},t.prototype.removeTile=function(i,r){var n=this._tiles[r];!n||i>=n.length||(n[i]=0)},t.prototype.setFlippedHorizontally=function(i,r,n){var l=this._tiles[r];if(l&&!(i>=l.length)){var o=l[i];o!==0&&(l[i]=B.setFlippedHorizontally(o,n))}},t.prototype.setFlippedVertically=function(i,r,n){var l=this._tiles[r];if(l&&!(i>=l.length)){var o=l[i];o!==0&&(l[i]=B.setFlippedVertically(o,n))}},t.prototype.setFlippedDiagonally=function(i,r,n){var l=this._tiles[r];if(l&&!(i>=l.length)){var o=l[i];o!==0&&(l[i]=B.setFlippedDiagonally(o,n))}},t.prototype.isFlippedHorizontally=function(i,r){var n=this._tiles[r];return!(!n||i>=n.length)&&B.isFlippedHorizontally(n[i])},t.prototype.isFlippedVertically=function(i,r){var n=this._tiles[r];return!(!n||i>=n.length)&&B.isFlippedVertically(n[i])},t.prototype.isFlippedDiagonally=function(i,r){var n=this._tiles[r];return!(!n||i>=n.length)&&B.isFlippedDiagonally(n[i])},t.prototype.getTileGID=function(i,r){var n=this._tiles[r];if(n&&!(i>=n.length)&&n[i]!==0)return n[i]-1},t.prototype.getTileId=function(i,r){var n=this._tiles[r];if(n&&!(i>=n.length)&&n[i]!==0)return B.getTileId(n[i]-1)},t.prototype.getDimensionX=function(){return this._tiles.length===0?0:this._tiles[0].length},t.prototype.getDimensionY=function(){return this._tiles.length},t.prototype.getWidth=function(){return this.tileMap.getWidth()},t.prototype.getHeight=function(){return this.tileMap.getHeight()},t}(_t),E=function(){function e(t){this.taggedHitBoxes=[],this.animationLength=t??0,this.stackedTiles=[]}return e.prototype.addHitBox=function(t,i){var r=this.taggedHitBoxes.find(function(n){return n.tag===t});r||(r={tag:t,polygons:[]},this.taggedHitBoxes.push(r)),r.polygons.push(i)},e.prototype.hasTaggedHitBox=function(t){return this.taggedHitBoxes.some(function(i){return i.tag===t})},e.prototype.getHitBoxes=function(t){var i=this.taggedHitBoxes.find(function(r){return r.tag===t});return i&&i.polygons},e.prototype.getAnimationLength=function(){return this.animationLength},e.prototype.getStackTileId=function(){return this.stackTileId},e.prototype.getStackedTiles=function(){return this.stackedTiles},e.prototype.hasStackedTiles=function(){return this.stackedTiles.length>0},e.prototype.setStackedTiles=function(t){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];this.stackedTiles=i,this.stackTileId=t},e}(),bt=function(){function e(){this._cachedValues=new Map,this._callbacks=new Map}return e.prototype.getOrLoad=function(t,i,r){var n=this,l=this._cachedValues.get(t);if(l)r(l);else{var o=this._callbacks.get(t);o?o.push(r):(this._callbacks.set(t,[r]),i(function(s){var p,a;s&&n._cachedValues.set(t,s);var d=n._callbacks.get(t);n._callbacks.delete(t);try{for(var c=W(d),u=c.next();!u.done;u=c.next())(0,u.value)(s)}catch(m){p={error:m}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(p)throw p.error}}}))}},e}(),dt=function(){function e(){this._levelBackgroundTextures=new Map,this._textures=new Map}return e.prototype.setTexture=function(t,i){this._textures.set(t,i)},e.prototype.getTexture=function(t){return this._textures.get(t)},e.prototype.getLevelBackgroundTexture=function(t){return this._levelBackgroundTextures.get(t)},e.prototype.setLevelBackgroundTexture=function(t,i){this._levelBackgroundTextures.set(t,i)},e}(),Dt=function(e,t){var i=t.data,r=t.compression;if(!i)return i;var n=4,l=[],o=atob(i).split("").map(function(d){return d.charCodeAt(0)});try{var s=function(d,c){return d[c]+(d[c+1]<<8)+(d[c+2]<<16)+(d[c+3]<<24)>>>0};if(r==="zlib")for(var p=new Uint8Array(o),a=e.inflate(p);n<=a.length;)l.push(s(a,n-4)),n+=4;else{if(r==="zstd")return console.error("Zstandard compression is not supported for layers in a Tilemap. Use instead zlib compression or no compression."),null;for(;n<=o.length;)l.push(s(o,n-4)),n+=4}return l}catch(d){return console.error("Failed to decompress and unzip base64 layer.data string",d),null}},mt=function(e){var t=e&Z,i=e&tt,r=e&et;return{id:rt(536870911&e),flippedHorizontally:!!t,flippedVertically:!!i,flippedDiagonally:!!r}};function rt(e){return e===0?void 0:e-1}var ut,kt=GlobalPIXIModule.PIXI;function pt(e,t){var i=e<<16;return i+=t}(function(e){e.parseAtlas=function(t,i,r,n){if(!t.tiledversion)return console.warn("The loaded Tiled map does not contain a 'tiledversion' key. Are you sure this file has been exported from Tiled (mapeditor.org)?"),null;if(!t.tilesets.length||"source"in t.tilesets[0])return console.warn("The loaded Tiled map seems not to contain any tileset data (nothing in 'tilesets' key)."),null;var l=t.tilesets[0],o=l.tilewidth,s=l.tileheight,p=l.tilecount,a=l.image,d=l.columns,c=l.spacing,u=l.margin,m=l.firstgid===void 0?1:l.firstgid;r||(r=n(a));var F=p/d,_=o*d+c*(d-1)+2*u,y=s*F+c*(F-1)+2*u;if(r.width!==1&&r.width<_||r.width>=_+c+o||r.height!==1&&r.height<y||r.height>=y+c+s)return console.error("It seems the atlas file was resized, which is not supported. "+"It should be ".concat(_,"x").concat(y," px, ")+"but it's ".concat(r.width,"x").concat(r.height," px.")),null;if(r.width!==1&&r.width!==_||r.height!==1&&r.height!==y)return console.warn("It seems the atlas file has unused pixels. "+"It should be ".concat(_,"x").concat(y," px, ")+"but it's ".concat(r.width,"x").concat(r.height," px.")),null;for(var w=new dt,f=0;f<p;f++){var T=u+Math.floor(f%d)*(o+c),I=u+Math.floor(f/d)*(s+c),H=rt(m+f);try{var g=new kt.Rectangle(T,I,o,s),D=new kt.Texture(r,g);w.setTexture(H,D)}catch(x){console.error("An error occurred while creating a PIXI.Texture to be used in a TileMap:",x)}}return w}})(ut||(ut={}));var ft,ht,yt,gt,vt,nt=GlobalPIXIModule.PIXI;function zt(e,t,i,r){var n;if(e[r])return e[r];var l=null,o=t[r];return(o==null?void 0:o.relPath)?((n=(l=i(o.relPath)).baseTexture)===null||n===void 0?void 0:n.cacheId)==="res/error48.png"&&(console.error('The atlas texture "'.concat(o.relPath,`" can't be loaded`)),l=null):console.error('The tileset "'.concat(o.identifier,`" doesn't seems to contain an atlas texture`)),e[r]=l,l}(function(e){e.parseAtlas=function(t,i,r,n){var l,o,s,p,a=t.levels[i>-1?i:0];if(!a||!a.layerInstances)return null;var d={};try{for(var c=W(t.defs.tilesets),u=c.next();!u.done;u=c.next())d[(T=u.value).uid]=T}catch(M){l={error:M}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(l)throw l.error}}for(var m=new dt,F={},_={},y=a.layerInstances.length-1;y>=0;--y){var w=a.layerInstances[y];if(w.__type!=="Entities"){var f=w.__tilesetDefUid;if(typeof f=="number"){var T=d[f],I=zt(_,d,n,f);if(I){var H={},g=T.tileGridSize;try{for(var D=(s=void 0,W(N(N([],Y(w.autoLayerTiles),!1),Y(w.gridTiles),!1))),x=D.next();!x.done;x=D.next()){var P=x.value;if(!H[P.t]){var V=pt(f,P.t);if(F[V])H[P.t]=!0;else{try{var k=Y(P.src,2),A=k[0],b=k[1],z=new nt.Rectangle(A,b,g,g),v=new nt.Texture(I,z);m.setTexture(V,v)}catch(M){console.error("An error occurred while creating a PIXI.Texture to be used in a TileMap:",M)}H[P.t]=!0,F[V]=!0}}}}catch(M){s={error:M}}finally{try{x&&!x.done&&(p=D.return)&&p.call(D)}finally{if(s)throw s.error}}}}}}if(a.bgRelPath){var L=n(a.bgRelPath);z=new nt.Rectangle(0,0,a.pxWid,a.pxHei),v=new nt.Texture(L,z),m.setLevelBackgroundTexture(a.bgRelPath,v)}return m}})(ft||(ft={})),C.PixiTileMapHelper=void 0,(ht=C.PixiTileMapHelper||(C.PixiTileMapHelper={})).parseAtlas=function(e,t,i,r){return e.kind==="ldtk"?ft.parseAtlas(e.data,t,i,r):e.kind==="tiled"?ut.parseAtlas(e.data,t,i,r):(console.warn("The loaded Tiled map data does not contain a 'tiledversion' or '__header__' key. Are you sure this file has been exported from Tiled (mapeditor.org) or LDtk (ldtk.io)?"),null)},ht.updatePixiTileMap=function(e,t,i,r,n){var l,o,s,p,a,d,c=e;if(c){c.clear();var u=t.getBackgroundResourceName();if(u){var m=i.getLevelBackgroundTexture(u);c.tile(m,0,0)}try{for(var F=W(t.getLayers()),_=F.next();!_.done;_=F.next()){var y=_.value;if(!(r==="index"&&n!==y.id||r==="visible"&&!y.isVisible())){if(y instanceof wt){var w=y;try{for(var f=(s=void 0,W(w.objects)),T=f.next();!T.done;T=f.next()){var I=T.value,H=I.getTileId();if(m=i.getTexture(H)){var g=st(H);c.tile(m,I.x,I.y-w.tileMap.getTileHeight(),{rotate:g})}}}catch(G){s={error:G}}finally{try{T&&!T.done&&(p=f.return)&&p.call(f)}finally{if(s)throw s.error}}}else if(y instanceof it)for(var D=y,x=D.tileMap.getTileWidth(),P=D.tileMap.getTileHeight(),V=D.tileMap.getDimensionX(),k=D.tileMap.getDimensionY(),A=D.getAlpha(),b=0;b<k;b++)for(var z=0;z<V;z++){var v=x*z,L=P*b;if((H=D.getTileGID(z,b))!==void 0){var M=B.getTileId(H),O=D.tileMap.getTileDefinition(M);if(O.hasStackedTiles())try{for(var S=(a=void 0,W(O.getStackedTiles())),R=S.next();!R.done;R=S.next()){var j=R.value,lt=B.getTileId(j);(X=i.getTexture(lt))&&(g=st(j),c.tile(X,v,L,{alpha:A,rotate:g}))}}catch(G){a={error:G}}finally{try{R&&!R.done&&(d=S.return)&&d.call(S)}finally{if(a)throw a.error}}else{var X;if(!(X=i.getTexture(M))){console.warn("Unknown tile id: ".concat(M," at (").concat(z,", ").concat(b,")"));continue}g=st(H);var U=c.tile(X,v,L,{alpha:A,rotate:g});O.getAnimationLength()>0&&U.tileAnimX(x,O.getAnimationLength())}}}}}}catch(G){l={error:G}}finally{try{_&&!_.done&&(o=F.return)&&o.call(F)}finally{if(l)throw l.error}}}},ht.updatePixiCollisionMask=function(e,t,i,r,n,l,o,s){var p,a,d,c;if(e){e.clear(),e.lineStyle(r,n,l),e.drawRect(0,0,t.getWidth(),t.getHeight());try{for(var u=W(t.getLayers()),m=u.next();!m.done;m=u.next()){var F=m.value,_=t.getTileWidth(),y=t.getTileHeight();if(F instanceof it)for(var w=F,f=0;f<w.tileMap.getDimensionY();f++)for(var T=0;T<w.tileMap.getDimensionX();T++){var I=_*T,H=y*f,g=w.getTileId(T,f),D=w.isFlippedHorizontally(T,f),x=w.isFlippedVertically(T,f),P=w.isFlippedDiagonally(T,f),V=w.tileMap.getTileDefinition(g);if(V){var k=V.getHitBoxes(i);if(k)try{for(var A=(d=void 0,W(k)),b=A.next();!b.done;b=A.next()){var z=b.value;if(z.length!==0){e.beginFill(o,s);for(var v=0;v<z.length;v++){var L=z[v][0],M=z[v][1];if(P){var O=L;L=M,M=O}D&&(L=_-L),x&&(M=y-M),v===0?e.moveTo(I+L,H+M):e.lineTo(I+L,H+M)}e.closePath(),e.endFill()}}}catch(S){d={error:S}}finally{try{b&&!b.done&&(c=A.return)&&c.call(A)}finally{if(d)throw d.error}}}}}}catch(S){p={error:S}}finally{try{m&&!m.done&&(a=u.return)&&a.call(u)}finally{if(p)throw p.error}}}},function(e){e.load=function(t,i){var r,n,l,o,s=t.levels[i>-1?i:0];if(!s||!s.layerInstances)return null;for(var p=new Map,a=0,d=0,c=0,u=s.layerInstances.length-1;u>=0;--u){var m=(g=s.layerInstances[u]).__tilesetDefUid,F={};try{for(var _=(r=void 0,W(N(N([],Y(g.autoLayerTiles),!1),Y(g.gridTiles),!1))),y=_.next();!y.done;y=_.next())if(!F[(k=y.value).t]){var w=pt(m,k.t);if(p.has(w))F[k.t]=!0;else{var f=new E(0);F[k.t]=!0,p.set(w,f)}}}catch(R){r={error:R}}finally{try{y&&!y.done&&(n=_.return)&&n.call(_)}finally{if(r)throw r.error}}g.__type!=="IntGrid"&&g.__type!=="AutoLayer"&&g.__type!=="Tiles"||(a===0?(a=g.__gridSize,d=g.__cWid,c=g.__cHei):g.__gridSize!==a&&console.warn("Grid size is different across layers. Only the first layer grid size will be followed."))}var T=new ct(a,a,d,c,p),I=new Map,H=268435455;for(u=s.layerInstances.length-1;u>=0;--u){var g,D=(g=s.layerInstances[u]).__gridSize,x=(m=g.__tilesetDefUid,T.addTileLayer(u));x.setAlpha(g.__opacity),x.setVisible(g.visible);try{for(var P=(l=void 0,W(N(N([],Y(g.autoLayerTiles),!1),Y(g.gridTiles),!1))),V=P.next();!V.done;V=P.next()){var k=V.value,A=Math.floor(k.px[0]/D),b=Math.floor(k.px[1]/D),z=(w=pt(m,k.t),x.getTileId(A,b));if(z===void 0)x.setTile(A,b,w),x.setFlippedHorizontally(A,b,k.f===1||k.f===3),x.setFlippedVertically(A,b,k.f===2||k.f===3);else{var v=It(w,k.f===1||k.f===3,k.f===2||k.f===3,!1),L=p.get(z);if(L==null?void 0:L.hasStackedTiles()){var M="".concat(L.getStackedTiles().map(function(R){return"".concat(R)}).join(";"),";").concat(v);if(f=I.get(M))x.setTile(A,b,f.getStackTileId());else{var O=new E(0);O.setStackedTiles.apply(O,N(N([H],Y(L.getStackedTiles()),!1),[v],!1)),p.set(H,O),H-=1,I.set(M,O),x.setTile(A,b,O.getStackTileId())}}else{var S=x.getTileGID(A,b);M="".concat(S,";").concat(v),(f=new E(0)).setStackedTiles(H,S,v),p.set(H,f),H-=1,I.set(M,f),x.setTile(A,b,f.getStackTileId())}}}}catch(R){l={error:R}}finally{try{V&&!V.done&&(o=P.return)&&o.call(P)}finally{if(l)throw l.error}}}return s.bgRelPath&&T.setBackgroundResourceName(s.bgRelPath),T}}(yt||(yt={})),function(e){e.load=function(t,i){var r,n,l,o,s,p,a,d,c,u;if(!t.tiledversion)return console.warn("The loaded Tiled map does not contain a 'tiledversion' key. Are you sure this file has been exported from Tiled (mapeditor.org)?"),null;var m=new Map;try{for(var F=W(t.tilesets),_=F.next();!_.done;_=F.next()){var y=_.value,w=y.firstgid===void 0?1:y.firstgid;if(y.tiles)try{for(var f=(l=void 0,W(y.tiles)),T=f.next();!T.done;T=f.next()){var I=T.value,H=new E(I.animation?I.animation.length:0);if(I.objectgroup){var g=function(h){var Tt=h.class||I.class;if(!Tt||Tt.length===0)return"continue";var ot=null;if(h.polygon){var Mt=h.rotation*Math.PI/180,$=Math.cos(Mt),J=Math.sin(Mt);$!==-1&&$!==1||(J=0),J!==-1&&J!==1||($=0),ot=h.polygon.map(function(at){return[h.x+at.x*$-at.y*J,h.y+at.x*J+at.y*$]})}else h.x!==void 0&&h.y!==void 0&&h.width!==void 0&&h.height!==void 0&&(ot=[[h.x,h.y],[h.x,h.y+h.height],[h.x+h.width,h.y+h.height],[h.x+h.width,h.y]]);ot&&H.addHitBox(Tt,ot)};try{for(var D=(s=void 0,W(I.objectgroup.objects)),x=D.next();!x.done;x=D.next())g(j=x.value)}catch(h){s={error:h}}finally{try{x&&!x.done&&(p=D.return)&&p.call(D)}finally{if(s)throw s.error}}}else if(I.class&&I.class.length>0){var P=[[0,0],[0,t.tileheight],[t.tilewidth,t.tileheight],[t.tilewidth,0]];H.addHitBox(I.class,P)}m.set(rt(w+I.id),H)}}catch(h){l={error:h}}finally{try{T&&!T.done&&(o=f.return)&&o.call(f)}finally{if(l)throw l.error}}for(var V=0;V<y.tilecount;V++){var k=rt(w+V);m.has(k)||m.set(k,new E(0))}}}catch(h){r={error:h}}finally{try{_&&!_.done&&(n=F.return)&&n.call(F)}finally{if(r)throw r.error}}var A=new ct(t.tilewidth,t.tileheight,t.width,t.height,m);try{for(var b=W(t.layers),z=b.next();!z.done;z=b.next()){var v=z.value;if(v.type==="objectgroup"){var L=A.addObjectLayer(v.id);L.setVisible(v.visible);try{for(var M=(c=void 0,W(v.objects)),O=M.next();!O.done;O=M.next()){var S=O.value;if(S.visible&&S.gid){var R=mt(S.gid),j=new Ht(S.x,S.y,R.id);L.add(j),j.setFlippedHorizontally(R.flippedHorizontally),j.setFlippedVertically(R.flippedVertically),j.setFlippedDiagonally(R.flippedDiagonally)}}}catch(h){c={error:h}}finally{try{O&&!O.done&&(u=M.return)&&u.call(M)}finally{if(c)throw c.error}}}else if(v.type==="tilelayer"){var lt=0,X=null;if(v.encoding==="base64"?(X=Dt(i,v))||console.warn("Failed to uncompress layer.data"):X=v.data,X){var U=A.addTileLayer(v.id);U.setAlpha(v.opacity),U.setVisible(v.visible);for(var G=0;G<v.height;G++)for(var K=0;K<v.width;K++){var At=X[lt],Q=mt(At);Q.id!==void 0&&(U.setTile(K,G,Q.id),U.setFlippedHorizontally(K,G,Q.flippedHorizontally),U.setFlippedVertically(K,G,Q.flippedVertically),U.setFlippedDiagonally(K,G,Q.flippedDiagonally)),lt+=1}}}}}catch(h){a={error:h}}finally{try{z&&!z.done&&(d=b.return)&&d.call(b)}finally{if(a)throw a.error}}return A}}(gt||(gt={})),function(e){e.load=function(t,i,r){return t.kind==="ldtk"?yt.load(t.data,i):t.kind==="tiled"?gt.load(t.data,r):(console.warn("The loaded Tile Map data does not contain a 'tiledversion' or '__header__' key. Are you sure this file has been exported from Tiled (mapeditor.org) or LDtk (ldtk.io)?"),null)}}(vt||(vt={}));var Ft=function(){function e(){this._tileMapCache=new bt,this._textureCacheCaches=new bt}return e.getManager=function(t){return t.tileMapCollisionMaskManager||(t.tileMapCollisionMaskManager=new e),t.tileMapCollisionMaskManager},e.identify=function(t){return t.tiledversion?(console.info("Detected the json file was created in Tiled"),{kind:"tiled",data:t}):t.__header__&&t.__header__.app==="LDtk"?(console.info("Detected the json/ldtk file was created in LDtk"),{kind:"ldtk",data:t}):(console.warn("The loaded Tile Map data does not contain a 'tiledversion' or '__header__' key. Are you sure this file has been exported from Tiled (mapeditor.org) or LDtk (ldtk.io)?"),console.log("The data that failed Tile Map identification is: ",t),null)},e.prototype.getOrLoadTileMap=function(t,i,r,n,l,o){var s=i+"|"+r+"|"+n;this._tileMapCache.getOrLoad(s,function(p){t(i,r,function(a){if(a){var d=vt.load(a,n,l);p(d)}else p(null)})},o)},e.prototype.getOrLoadTextureCache=function(t,i,r,n,l,o,s){var p=n+"|"+l+"|"+r+"|"+o;this._textureCacheCaches.getOrLoad(p,function(a){t(n,l,function(d){if(d){var c=r?i(r):null,u=C.PixiTileMapHelper.parseAtlas(d,o,c,i);a(u)}else a(null)})},s)},e}();C.EditableTileMap=ct,C.EditableTileMapLayer=it,C.TileDefinition=E,C.TileMapManager=Ft,C.TileTextureCache=dt,Object.defineProperty(C,"__esModule",{value:!0})});
//# sourceMappingURL=TileMapHelper.js.map
